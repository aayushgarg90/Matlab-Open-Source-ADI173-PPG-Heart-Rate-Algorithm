<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="comment"><span class="message fatal" id="M1F1C">%</span>% Process_PPG_LogFile.m </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line">clear;clc;</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   input a filename of a file generated from PNI PPG BLE GATT data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/VectorAM_BPM63-58.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/Vector5_BPM63-96-60.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/SENtrode2015-03-11-20-35-27.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%DataLogFilename = 'C:\temp\capture.txt';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/SENtrode2015-03-30-23-31-01.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/Vector6.txt';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/SENtrode2015-04-03-18-55-38.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/SENtrode2015-04-09-23-49-21.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/3LEDchanges.txt';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%DataLogFilename = 'Test_Vectors/SENtrode2015-04-10-17-17-50.csv';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="var type0" id="S3T0U9">DataLogFilename</span> = <span class="string">'SENtrodePPGLog.csv'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% datalog file prototype (index:field name)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%   1:Timestamp, 2:peripheral, 3:id,          4:GATT,        5:heartrate,   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%   6:ax,        7:ay,         8:az,          9:aTimestamp, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%  10:SLOTA_PD1, 11:SLOTA_PD2, 12:SLOTA_PD3, 13:SLOTA_PD4,  14: rawTimestamp,   </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%  15:led,  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%  16:SLOTB_PD1, 17:SLOTB_PD2, 18:SLOTB_PD3, 19:SLOTB_PD4,  20:rawTimestamp,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%  21:rawPulse,  22:firmware</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">% NOTE on wrapped vs. unwrapped Sensor Timestamps and AppTimestamps</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% The Process_NewPPGData function can deal with unwrapped timestamps.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%   It unwraps values only as needed (to compare to a previous value for</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%   pulse rate calculation)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% In this Matlab code, for further anaysis and comparison to reference </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%  sensors the SensorTimestamp domain will be used over the application </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%  timestamp, which is known to be inconsistant.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%% Setup data structures</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="var type0" id="S4T0U13">PPG_struct</span> = initPPG_struct();</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="var type0" id="S6T0U18">Filt_struct</span> = initFilt_struct();</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%% read input file</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%M = csvread(DataLogFilename,1,0); % with offset for header row</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%M_Len = size(M,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%T = readtable(DataLogFilename);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="keyword">if</span> ~exist(<span class="var type0" id="S3T0U26">DataLogFilename</span>,<span class="string">'file'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">    fprintf(<span class="string">'Cannot find input file: %s\nProcess Stopped\n'</span>,<span class="var type0" id="S3T0U32">DataLogFilename</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">    <span class="var type0" id="S10T0U36">fileID</span> = fopen(<span class="var type0" id="S3T0U39">DataLogFilename</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">    <span class="var type0" id="S12T0U42">OneRow</span> = fgetl(<span class="var type0" id="S10T0U45">fileID</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">    <span class="var type0" id="S14T0U48">Index</span> = 1;<span class="var type0" id="S15T0U52">LineNumber</span> = 1; <span class="var type0" id="S16T0U56">FirstError</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    fprintf(<span class="string">'Reading<span class="keyword">...</span>\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">    <span class="var type0" id="S17T0U64">BadLines</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="keyword">while</span> ~feof(<span class="var type0" id="S10T0U70">fileID</span>)                <span class="comment">% Corrupt Rows of data where found to be common</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">        <span class="var type0" id="S12T0U73">OneRow</span> = fgetl(<span class="var type0" id="S10T0U76">fileID</span>);          <span class="comment">% this step necessary to weed them out</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">        <span class="keyword">if</span> length(strfind(<span class="var type0" id="S12T0U84">OneRow</span>,<span class="string">','</span>)) == 21   <span class="comment">% Allow only if proper num of delimiters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">            <span class="var type0" id="S21T0U89">M</span> = textscan(<span class="var type0" id="S12T0U92">OneRow</span>,<span class="string">'%f%s%s%s%d%f%f%f%d%d%d%d%d%d%d%d%d%d%d%d%d%d'</span>,<span class="string">'Delimiter'</span>,<span class="string">','</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">            <span class="keyword">if</span> <span class="var type0" id="S14T0U99">Index</span>==1, <span class="var type0" id="S23T0U103">T_Zero</span> = double(<span class="var type0" id="S21T0U107">M</span>{1});<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">            <span class="comment">%        if Index==1, T_Zero = double(0);end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">            <span class="comment">% Parse csvread output array 'M' into meaningful variable names</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">            <span class="var type0" id="S25T0U112">Timestamp</span>(<span class="var type0" id="S14T0U113">Index</span>)          =   double(<span class="var type0" id="S21T0U118">M</span>{1}) - <span class="var type0" id="S23T0U120">T_Zero</span>; <span class="comment">%1/1000 second inc</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">            <span class="var type0" id="S26T0U124">Peripheral</span>(<span class="var type0" id="S14T0U125">Index</span>)         =   <span class="var type0" id="S21T0U127">M</span>{2};</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">            <span class="var type0" id="S27T0U132">ID</span>(<span class="var type0" id="S14T0U133">Index</span>)                 =   <span class="var type0" id="S21T0U135">M</span>{3};</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U143">M</span>{4}),          <span class="var type0" id="S29T0U148">GATT</span>(<span class="var type0" id="S14T0U149">Index</span>)               =   <span class="var type0" id="S21T0U151">M</span>{4};</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S29T0U157">GATT</span>(<span class="var type0" id="S14T0U158">Index</span>)               =   <span class="string">''</span>;<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U166">M</span>{5}),          <span class="var type0" id="S30T0U171">MeanHeartPulseRate</span>(<span class="var type0" id="S14T0U172">Index</span>) =   uint8(<span class="var type0" id="S21T0U176">M</span>{5});</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S30T0U182">MeanHeartPulseRate</span>(<span class="var type0" id="S14T0U183">Index</span>) =   uint8(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U193">M</span>{6}),          <span class="var type0" id="S32T0U198">AX</span>(<span class="var type0" id="S14T0U199">Index</span>)                 =   single(<span class="var type0" id="S21T0U203">M</span>{6});</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S32T0U209">AX</span>(<span class="var type0" id="S14T0U210">Index</span>)                 =   single(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U220">M</span>{7}),          <span class="var type0" id="S34T0U225">AY</span>(<span class="var type0" id="S14T0U226">Index</span>)                 =   single(<span class="var type0" id="S21T0U230">M</span>{7});</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S34T0U236">AY</span>(<span class="var type0" id="S14T0U237">Index</span>)                 =   single(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U247">M</span>{8}),          <span class="var type0" id="S35T0U252">AZ</span>(<span class="var type0" id="S14T0U253">Index</span>)                 =   single(<span class="var type0" id="S21T0U257">M</span>{8});</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S35T0U263">AZ</span>(<span class="var type0" id="S14T0U264">Index</span>)                 =   single(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U274">M</span>{9}),          <span class="var type0" id="S36T0U279">AccTimestamp</span>(<span class="var type0" id="S14T0U280">Index</span>)       =   uint16(<span class="var type0" id="S21T0U284">M</span>{9});</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S36T0U290">AccTimestamp</span>(<span class="var type0" id="S14T0U291">Index</span>)       =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U301">M</span>{10}),         <span class="var type0" id="S38T0U306">SlotA_PD1</span>(<span class="var type0" id="S14T0U307">Index</span>)          =   uint16(<span class="var type0" id="S21T0U311">M</span>{10});</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S38T0U317">SlotA_PD1</span>(<span class="var type0" id="S14T0U318">Index</span>)          =   uint16(0); <span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U328">M</span>{11}),         <span class="var type0" id="S39T0U333">SlotA_PD2</span>(<span class="var type0" id="S14T0U334">Index</span>)          =   uint16(<span class="var type0" id="S21T0U338">M</span>{11});</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S39T0U344">SlotA_PD2</span>(<span class="var type0" id="S14T0U345">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U355">M</span>{12}),         <span class="var type0" id="S40T0U360">SlotA_PD3</span>(<span class="var type0" id="S14T0U361">Index</span>)          =   uint16(<span class="var type0" id="S21T0U365">M</span>{12});</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S40T0U371">SlotA_PD3</span>(<span class="var type0" id="S14T0U372">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U382">M</span>{13}),         <span class="var type0" id="S41T0U387">SlotA_PD4</span>(<span class="var type0" id="S14T0U388">Index</span>)          =   uint16(<span class="var type0" id="S21T0U392">M</span>{13});</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S41T0U398">SlotA_PD4</span>(<span class="var type0" id="S14T0U399">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U409">M</span>{14}),         <span class="var type0" id="S42T0U414">SlotA_Timestamp</span>(<span class="var type0" id="S14T0U415">Index</span>)    =   uint32(<span class="var type0" id="S21T0U419">M</span>{14});</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S42T0U425">SlotA_Timestamp</span>(<span class="var type0" id="S14T0U426">Index</span>)    =   2^16;<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U436">M</span>{15}),         <span class="var type0" id="S44T0U441">Status</span>(<span class="var type0" id="S14T0U442">Index</span>)             =   uint8(<span class="var type0" id="S21T0U446">M</span>{15});</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S44T0U452">Status</span>(<span class="var type0" id="S14T0U453">Index</span>)             =   uint8(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U463">M</span>{16}),         <span class="var type0" id="S45T0U468">SlotB_PD1</span>(<span class="var type0" id="S14T0U469">Index</span>)          =   uint16(<span class="var type0" id="S21T0U473">M</span>{16});</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S45T0U479">SlotB_PD1</span>(<span class="var type0" id="S14T0U480">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U490">M</span>{17}),         <span class="var type0" id="S46T0U495">SlotB_PD2</span>(<span class="var type0" id="S14T0U496">Index</span>)          =   uint16(<span class="var type0" id="S21T0U500">M</span>{17});</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S46T0U506">SlotB_PD2</span>(<span class="var type0" id="S14T0U507">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U517">M</span>{18}),         <span class="var type0" id="S47T0U522">SlotB_PD3</span>(<span class="var type0" id="S14T0U523">Index</span>)          =   uint16(<span class="var type0" id="S21T0U527">M</span>{18});</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S47T0U533">SlotB_PD3</span>(<span class="var type0" id="S14T0U534">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U544">M</span>{19}),         <span class="var type0" id="S48T0U549">SlotB_PD4</span>(<span class="var type0" id="S14T0U550">Index</span>)          =   uint16(<span class="var type0" id="S21T0U554">M</span>{19});</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S48T0U560">SlotB_PD4</span>(<span class="var type0" id="S14T0U561">Index</span>)          =   uint16(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U571">M</span>{20}),         <span class="var type0" id="S49T0U576">SlotB_Timestamp</span>(<span class="var type0" id="S14T0U577">Index</span>)    =   uint32(<span class="var type0" id="S21T0U581">M</span>{20});</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S49T0U587">SlotB_Timestamp</span>(<span class="var type0" id="S14T0U588">Index</span>)    =   2^16;<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U598">M</span>{21}),         <span class="var type0" id="S50T0U603">Raw_PulseRate</span>(<span class="var type0" id="S14T0U604">Index</span>)      =   uint8(<span class="var type0" id="S21T0U608">M</span>{21});</span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S50T0U614">Raw_PulseRate</span>(<span class="var type0" id="S14T0U615">Index</span>)      =   uint8(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type0" id="S21T0U625">M</span>{22}),         <span class="var type0" id="S51T0U630">Firmware_Level</span>(<span class="var type0" id="S14T0U631">Index</span>)     =   uint8(<span class="var type0" id="S21T0U635">M</span>{22});</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">            <span class="keyword">else</span>                        <span class="var type0" id="S51T0U641">Firmware_Level</span>(<span class="var type0" id="S14T0U642">Index</span>)     =   uint8(0);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">            <span class="var type0" id="S14T0U648">Index</span> = <span class="var type0" id="S14T0U650">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">            <span class="keyword">if</span> <span class="var type0" id="S16T0U655">FirstError</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">                fprintf(<span class="string">'Error(s) found on the following Datalog line(s):'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">            fprintf(<span class="string">'%d '</span>,<span class="var type0" id="S15T0U665">LineNumber</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">            <span class="var type0" id="S17T0U669">BadLines</span> = <span class="var type0" id="S17T0U671">BadLines</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">            <span class="var type0" id="S16T0U675">FirstError</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">        <span class="var type0" id="S15T0U679">LineNumber</span> = <span class="var type0" id="S15T0U681">LineNumber</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">    fclose(<span class="var type0" id="S10T0U686">fileID</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">    <span class="var type0" id="S53T0U689">M_Len</span> = <span class="var type0" id="S14T0U691">Index</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">    <span class="comment">%split the values in the status field into its 2 components</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    <span class="var type0" id="S54T0U696">NumberLEDPulses</span>(1:<span class="var type0" id="S53T0U699">M_Len</span>)    =   mod(<span class="var type0" id="S44T0U703">Status</span>(1:<span class="var type0" id="S53T0U706">M_Len</span>),64);</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">    <span class="var type0" id="S56T0U711">Stillness</span>(1:<span class="var type0" id="S53T0U714">M_Len</span>)          =   (<span class="var type0" id="S44T0U719">Status</span>(1:<span class="var type0" id="S53T0U722">M_Len</span>)-<span class="var type0" id="S54T0U724">NumberLEDPulses</span>(1:<span class="var type0" id="S53T0U727">M_Len</span>))/64;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">    <span class="comment">% NOTE: MeanHeartPulseRate is the only NON-Raw data retrieved from the CSV</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">    <span class="comment">%       file. It is the mean pulse rate calculated by the firware in</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">    <span class="comment">%       SENtral. MeanPulseRate below should calculate identical value if</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">    <span class="comment">%       the two algorithms still match. PulseRate below is the local</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">    <span class="comment">%       Matlab PPG algorithms' (called below) raw unfiltered pulse rate.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">    fprintf(<span class="string">'\n\nDatafile: "%s"  has \n'</span>,<span class="var type0" id="S3T0U733">DataLogFilename</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">    fprintf(<span class="string">'%d Bad lines\n'</span>,<span class="var type0" id="S17T0U738">BadLines</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">    fprintf(<span class="string">'%d Good lines\n'</span>,<span class="var type0" id="S53T0U743">M_Len</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">    <span class="comment">%% Parse data fields into contiguous arrays</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">    fprintf(<span class="string">'Parsing SlotA data<span class="keyword">...</span>.\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">    <span class="comment">%collect only valid Green LED "Slot A" (GATT Mode 21) data into gap-free arrays</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">    <span class="var type0" id="S14T0U750">Index</span> = 1; <span class="var type0" id="S57T0U754">count</span> = 1;<span class="var type0" id="S58T0U758">Wraps</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">    <span class="keyword">while</span> <span class="var type0" id="S14T0U762">Index</span> &lt; <span class="var type0" id="S53T0U763">M_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">while</span> (<span class="var type0" id="S14T0U768">Index</span> &lt; <span class="var type0" id="S53T0U769">M_Len</span>) &amp;&amp; ((<span class="var type0" id="S42T0U775">SlotA_Timestamp</span>(<span class="var type0" id="S14T0U776">Index</span>) == 0) &amp;&amp; (<span class="var type0" id="S38T0U781">SlotA_PD1</span>(<span class="var type0" id="S14T0U782">Index</span>) == 0))</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">            <span class="var type0" id="S14T0U786">Index</span> = <span class="var type0" id="S14T0U788">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">        <span class="keyword">if</span> <span class="var type0" id="S14T0U793">Index</span> &lt; <span class="var type0" id="S53T0U794">M_Len</span>    <span class="comment">% grab GATT Mode 21 data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">            <span class="var type0" id="S59T0U798">p_AppTimestamp</span>(<span class="var type0" id="S57T0U799">count</span>)       =  <span class="var type0" id="S25T0U801">Timestamp</span>(<span class="var type0" id="S14T0U802">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">            <span class="var type0" id="S60T0U806">p_SlotA_Timestamp</span>(<span class="var type0" id="S57T0U807">count</span>)    =  uint16(<span class="var type0" id="S42T0U811">SlotA_Timestamp</span>(<span class="var type0" id="S14T0U812">Index</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">            <span class="var type0" id="S61T0U816">p_SlotA_PD1</span>(<span class="var type0" id="S57T0U817">count</span>)          =  <span class="var type0" id="S38T0U819">SlotA_PD1</span>(<span class="var type0" id="S14T0U820">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">            <span class="var type0" id="S62T0U824">p_SlotA_PD2</span>(<span class="var type0" id="S57T0U825">count</span>)          =  <span class="var type0" id="S39T0U827">SlotA_PD2</span>(<span class="var type0" id="S14T0U828">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">            <span class="var type0" id="S63T0U832">p_SlotA_PD3</span>(<span class="var type0" id="S57T0U833">count</span>)          =  <span class="var type0" id="S40T0U835">SlotA_PD3</span>(<span class="var type0" id="S14T0U836">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">            <span class="var type0" id="S64T0U840">p_SlotA_PD4</span>(<span class="var type0" id="S57T0U841">count</span>)          =  <span class="var type0" id="S41T0U843">SlotA_PD4</span>(<span class="var type0" id="S14T0U844">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">            <span class="var type0" id="S65T0U848">p_NumberLEDPulses</span>(<span class="var type0" id="S57T0U849">count</span>)    =  <span class="var type0" id="S54T0U851">NumberLEDPulses</span>(<span class="var type0" id="S14T0U852">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">            <span class="var type0" id="S66T0U856">p_Stillness</span>(<span class="var type0" id="S57T0U857">count</span>)          =  <span class="var type0" id="S56T0U859">Stillness</span>(<span class="var type0" id="S14T0U860">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">            <span class="var type0" id="S67T0U864">p_MeanHeartPulseRate</span>(<span class="var type0" id="S57T0U865">count</span>) =  <span class="var type0" id="S30T0U867">MeanHeartPulseRate</span>(<span class="var type0" id="S14T0U868">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">            <span class="keyword">if</span> (<span class="var type0" id="S57T0U873">count</span> &gt; 1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">                <span class="keyword">if</span> (uint32(<span class="var type0" id="S60T0U883">p_SlotA_Timestamp</span>(<span class="var type0" id="S57T0U884">count</span>))+ <span class="var type0" id="S58T0U886">Wraps</span>*2^16) &lt; <span class="var type0" id="S68T0U891">p_SensorTimestamp</span>(<span class="var type0" id="S57T0U893">count</span>-1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">                    <span class="var type0" id="S58T0U897">Wraps</span> = <span class="var type0" id="S58T0U899">Wraps</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">            <span class="var type0" id="S68T0U904">p_SensorTimestamp</span>(<span class="var type0" id="S57T0U905">count</span>) = uint32(<span class="var type0" id="S60T0U910">p_SlotA_Timestamp</span>(<span class="var type0" id="S57T0U911">count</span>)) + <span class="var type0" id="S58T0U913">Wraps</span>*2^16;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">            <span class="comment">% get Raw Pulse rate, which is attached to the next line (GATT Mode 22)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">            <span class="keyword">if</span> strcmp(<span class="var type0" id="S26T0U923">Peripheral</span>{<span class="var type0" id="S14T0U924">Index</span>}(1:3),<span class="string">'PPG'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">                <span class="var type0" id="S70T0U932">p_Raw_PulseRate</span>(<span class="var type0" id="S57T0U933">count</span>) = <span class="var type0" id="S50T0U935">Raw_PulseRate</span>(<span class="var type0" id="S14T0U936">Index</span>); <span class="comment">% line are combined</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">                <span class="keyword">if</span> (<span class="var type0" id="S14T0U942">Index</span> &lt; <span class="var type0" id="S53T0U943">M_Len</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">                    <span class="keyword">if</span> (<span class="var type0" id="S49T0U949">SlotB_Timestamp</span>(<span class="var type0" id="S14T0U951">Index</span>+1) ~= 0)</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">                        <span class="var type0" id="S70T0U957">p_Raw_PulseRate</span>(<span class="var type0" id="S57T0U958">count</span>) =  <span class="var type0" id="S50T0U960">Raw_PulseRate</span>(<span class="var type0" id="S14T0U962">Index</span>+1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">                        <span class="var type0" id="S70T0U968">p_Raw_PulseRate</span>(<span class="var type0" id="S57T0U969">count</span>) =  0; <span class="comment">% GATT Mode 22 line missing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">                    <span class="var type0" id="S70T0U975">p_Raw_PulseRate</span>(<span class="var type0" id="S57T0U976">count</span>)     =  0; <span class="comment">% EOF</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">            <span class="var type0" id="S57T0U980">count</span> = <span class="var type0" id="S57T0U982">count</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">            <span class="var type0" id="S14T0U986">Index</span> = <span class="var type0" id="S14T0U988">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">    <span class="var type0" id="S71T0U992">p_Len</span> = <span class="var type0" id="S57T0U994">count</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">    fprintf(<span class="string">'Parsing SlotB data<span class="keyword">...</span>.\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">    <span class="comment">%collect only valid IR LED "Slot B" (GATT Mode 22) data into gap-free arrays</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">    <span class="var type0" id="S14T0U1002">Index</span> = 1; <span class="var type0" id="S57T0U1006">count</span> = 1;<span class="var type0" id="S58T0U1010">Wraps</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">    <span class="keyword">while</span> <span class="var type0" id="S14T0U1014">Index</span> &lt; <span class="var type0" id="S53T0U1015">M_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">        <span class="keyword">while</span> (<span class="var type0" id="S14T0U1020">Index</span> &lt; <span class="var type0" id="S53T0U1021">M_Len</span>) &amp;&amp; ((<span class="var type0" id="S49T0U1027">SlotB_Timestamp</span>(<span class="var type0" id="S14T0U1028">Index</span>) == 0) &amp;&amp; (<span class="var type0" id="S45T0U1033">SlotB_PD1</span>(<span class="var type0" id="S14T0U1034">Index</span>) == 0))</span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">            <span class="var type0" id="S14T0U1038">Index</span> = <span class="var type0" id="S14T0U1040">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">        <span class="keyword">if</span> <span class="var type0" id="S14T0U1045">Index</span> &lt; <span class="var type0" id="S53T0U1046">M_Len</span>    <span class="comment">% grab GATT Mode 22 data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">            <span class="var type0" id="S72T0U1050">pb_AppTimestamp</span>(<span class="var type0" id="S57T0U1051">count</span>)       =  <span class="var type0" id="S25T0U1053">Timestamp</span>(<span class="var type0" id="S14T0U1054">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">            <span class="var type0" id="S73T0U1058">pb_SlotB_Timestamp</span>(<span class="var type0" id="S57T0U1059">count</span>)    =  uint16(<span class="var type0" id="S49T0U1063">SlotB_Timestamp</span>(<span class="var type0" id="S14T0U1064">Index</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">            <span class="var type0" id="S74T0U1068">pb_SlotB_PD1</span>(<span class="var type0" id="S57T0U1069">count</span>)          =  <span class="var type0" id="S45T0U1071">SlotB_PD1</span>(<span class="var type0" id="S14T0U1072">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">            <span class="var type0" id="S75T0U1076">pb_SlotB_PD2</span>(<span class="var type0" id="S57T0U1077">count</span>)          =  <span class="var type0" id="S46T0U1079">SlotB_PD2</span>(<span class="var type0" id="S14T0U1080">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">            <span class="var type0" id="S76T0U1084">pb_SlotB_PD3</span>(<span class="var type0" id="S57T0U1085">count</span>)          =  <span class="var type0" id="S47T0U1087">SlotB_PD3</span>(<span class="var type0" id="S14T0U1088">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">            <span class="var type0" id="S77T0U1092">pb_SlotB_PD4</span>(<span class="var type0" id="S57T0U1093">count</span>)          =  <span class="var type0" id="S48T0U1095">SlotB_PD4</span>(<span class="var type0" id="S14T0U1096">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">            <span class="keyword">if</span> (<span class="var type0" id="S57T0U1101">count</span> &gt; 1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">                <span class="keyword">if</span> (uint32(<span class="var type0" id="S73T0U1111">pb_SlotB_Timestamp</span>(<span class="var type0" id="S57T0U1112">count</span>))+ <span class="var type0" id="S58T0U1114">Wraps</span>*2^16) &lt; <span class="var type0" id="S78T0U1119">pb_SensorTimestamp</span>(<span class="var type0" id="S57T0U1121">count</span>-1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">                    <span class="var type0" id="S58T0U1125">Wraps</span> = <span class="var type0" id="S58T0U1127">Wraps</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">            <span class="var type0" id="S78T0U1132">pb_SensorTimestamp</span>(<span class="var type0" id="S57T0U1133">count</span>) = uint32(<span class="var type0" id="S73T0U1138">pb_SlotB_Timestamp</span>(<span class="var type0" id="S57T0U1139">count</span>)) + <span class="var type0" id="S58T0U1141">Wraps</span>*2^16;</span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">            <span class="var type0" id="S57T0U1147">count</span> = <span class="var type0" id="S57T0U1149">count</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">            <span class="var type0" id="S14T0U1153">Index</span> = <span class="var type0" id="S14T0U1155">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">    <span class="var type0" id="S79T0U1159">pb_Len</span> = <span class="var type0" id="S57T0U1161">count</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">    <span class="keyword">if</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">        <span class="comment">%Parse The Reference Heart Rates into  contiguous arrays</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">        fprintf(<span class="string">'Parsing Refernce Heart Rate Sensor data<span class="keyword">...</span>.\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">        <span class="comment">%Determin number of peripherals (refernce HPR sensors) used in this log</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">        <span class="var type0" id="S14T0U1172">Index</span> = 1; <span class="var type0" id="S80T0U1176">NumberOfRefs</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">        clear <span class="string">RefPeripherals</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">        <span class="keyword">while</span> <span class="var type0" id="S14T0U1183">Index</span> &lt; <span class="var type0" id="S53T0U1184">M_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">            <span class="keyword">if</span> ~strcmp(<span class="var type0" id="S26T0U1191">Peripheral</span>(<span class="var type0" id="S14T0U1192">Index</span>),<span class="string">'BlueNRG'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">                <span class="keyword">if</span> <span class="var type0" id="S80T0U1197">NumberOfRefs</span> &gt; 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">                    <span class="var type0" id="S81T0U1201">Test</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">                    <span class="keyword">for</span> <span class="var type0" id="S82T0U1205">i</span> = 1:<span class="var type0" id="S80T0U1208">NumberOfRefs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line">                        <span class="keyword">if</span> strcmp(<span class="var type0" id="S26T0U1214">Peripheral</span>(<span class="var type0" id="S14T0U1215">Index</span>),<span class="var type0" id="S83T0U1217">RefPeripherals</span>(<span class="var type0" id="S82T0U1218">i</span>))</span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line">                            <span class="var type0" id="S81T0U1221">Test</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">                    <span class="keyword">if</span> <span class="var type0" id="S81T0U1226">Test</span> == 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">                        <span class="var type0" id="S80T0U1230">NumberOfRefs</span> = <span class="var type0" id="S80T0U1232">NumberOfRefs</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">                        <span class="var type0" id="S83T0U1237">RefPeripherals</span>(<span class="var type0" id="S80T0U1238">NumberOfRefs</span>) = <span class="var type0" id="S26T0U1240">Peripheral</span>(<span class="var type0" id="S14T0U1241">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line">                    <span class="var type0" id="S80T0U1245">NumberOfRefs</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line">                    <span class="var type0" id="S83T0U1250">RefPeripherals</span>(<span class="var type0" id="S80T0U1251">NumberOfRefs</span>) = <span class="var type0" id="S26T0U1253">Peripheral</span>(<span class="var type0" id="S14T0U1254">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">            <span class="var type0" id="S14T0U1257">Index</span> = <span class="var type0" id="S14T0U1259">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">        fprintf(<span class="string">'%d Refernce Heart Rates Sensors used\n\n'</span>,<span class="var type0" id="S80T0U1265">NumberOfRefs</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line">        <span class="comment">% begin parsing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line">        <span class="var type0" id="S14T0U1268">Index</span> = 1; <span class="var type0" id="S57T0U1272">count</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line">        <span class="var type0" id="S84T0U1276">r_Len</span> = zeros(<span class="var type0" id="S80T0U1279">NumberOfRefs</span>,1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S86T0U1283">RefNum</span> = 1:<span class="var type0" id="S80T0U1286">NumberOfRefs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line">            <span class="var type0" id="S14T0U1289">Index</span> = 1; <span class="var type0" id="S57T0U1293">count</span> = 1; <span class="var type0" id="S87T0U1297">ThesePointsAreUseless</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line">            <span class="keyword">while</span> (<span class="var type0" id="S14T0U1303">Index</span> &lt; <span class="var type0" id="S53T0U1304">M_Len</span>)  &amp;&amp; (<span class="var type0" id="S87T0U1307">ThesePointsAreUseless</span> == 0)</span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line">                <span class="keyword">while</span> (<span class="var type0" id="S14T0U1313">Index</span> &lt; <span class="var type0" id="S53T0U1314">M_Len</span>) &amp;&amp; (~strcmp(<span class="var type0" id="S26T0U1320">Peripheral</span>(<span class="var type0" id="S14T0U1321">Index</span>),<span class="var type0" id="S83T0U1323">RefPeripherals</span>(<span class="var type0" id="S86T0U1324">RefNum</span>)))</span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line">                    <span class="var type0" id="S14T0U1327">Index</span> = <span class="var type0" id="S14T0U1329">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line">                <span class="keyword">if</span> <span class="var type0" id="S14T0U1334">Index</span> &lt; <span class="var type0" id="S53T0U1335">M_Len</span>    <span class="comment">% grab refernce heart rate for this peripheral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line">                    <span class="var type0" id="S88T0U1338">j</span> = 1;  <span class="comment">%find closest sensor timestamp</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line">                    <span class="keyword">while</span> (<span class="var type0" id="S88T0U1344">j</span> &lt; <span class="var type0" id="S71T0U1345">p_Len</span>) &amp;&amp; (<span class="var type0" id="S25T0U1349">Timestamp</span>(<span class="var type0" id="S14T0U1350">Index</span>) &gt; <span class="var type0" id="S59T0U1352">p_AppTimestamp</span>(<span class="var type0" id="S88T0U1353">j</span>))</span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line">                        <span class="var type0" id="S88T0U1356">j</span> = <span class="var type0" id="S88T0U1358">j</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line">                    <span class="keyword">if</span> <span class="var type0" id="S88T0U1363">j</span> &lt; <span class="var type0" id="S71T0U1364">p_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line">                        <span class="var type0" id="S89T0U1368">r_SensorTimestamp</span>(<span class="var type0" id="S86T0U1369">RefNum</span>,<span class="var type0" id="S57T0U1370">count</span>)     = <span class="var type0" id="S68T0U1372">p_SensorTimestamp</span>(<span class="var type0" id="S88T0U1373">j</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line">                        <span class="var type0" id="S90T0U1377">r_AppTimestamp</span>(<span class="var type0" id="S86T0U1378">RefNum</span>,<span class="var type0" id="S57T0U1379">count</span>)        = <span class="var type0" id="S25T0U1381">Timestamp</span>(<span class="var type0" id="S14T0U1382">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line">                        <span class="var type0" id="S91T0U1386">r_RefHeartPulseRate</span>(<span class="var type0" id="S86T0U1387">RefNum</span>,<span class="var type0" id="S57T0U1388">count</span>)   = <span class="var type0" id="S30T0U1390">MeanHeartPulseRate</span>(<span class="var type0" id="S14T0U1391">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line">                        <span class="var type0" id="S57T0U1394">count</span> = <span class="var type0" id="S57T0U1396">count</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line">                        <span class="var type0" id="S87T0U1401">ThesePointsAreUseless</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line">                <span class="var type0" id="S14T0U1405">Index</span> = <span class="var type0" id="S14T0U1407">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line">            <span class="var type0" id="S84T0U1412">r_Len</span>(<span class="var type0" id="S86T0U1413">RefNum</span>) = <span class="var type0" id="S57T0U1415">count</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line">            <span class="comment">%     if r_Len(RefNum) &lt; p_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line">            <span class="comment">%         r_AppTimestamp(RefNum,r_Len(RefNum)+1:p_Len) = zeros(1,p_Len-r_Len(RefNum));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line">            <span class="comment">%         r_MeanHeartPulseRate(RefNum,r_Len(RefNum)+1:p_Len) = zeros(1,p_Len-r_Len(RefNum));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line">            <span class="comment">%         r_Len(RefNum) = p_Len;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line">            <span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,287" id="srcline287">287</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,288" id="srcline288">288</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,289" id="srcline289">289</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,290" id="srcline290">290</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,291" id="srcline291">291</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,292" id="srcline292">292</a></span><span class="line">    <span class="comment">%Parse Accelerometer data into contiguous arrays</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,293" id="srcline293">293</a></span><span class="line">    fprintf(<span class="string">'Parsing Accel Data<span class="keyword">...</span>.\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,294" id="srcline294">294</a></span><span class="line">    <span class="var type0" id="S14T0U1423">Index</span> = 1; <span class="var type0" id="S57T0U1427">count</span> = 1;<span class="var type0" id="S58T0U1431">Wraps</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,295" id="srcline295">295</a></span><span class="line">    <span class="keyword">while</span> <span class="var type0" id="S14T0U1435">Index</span> &lt; <span class="var type0" id="S53T0U1436">M_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,296" id="srcline296">296</a></span><span class="line">        <span class="keyword">while</span> (<span class="var type0" id="S14T0U1441">Index</span> &lt; <span class="var type0" id="S53T0U1442">M_Len</span>) &amp;&amp; (<span class="var type0" id="S36T0U1446">AccTimestamp</span>(<span class="var type0" id="S14T0U1447">Index</span>) == 0)</span></span>
<span class="srcline"><span class="lineno"><a href="1,297" id="srcline297">297</a></span><span class="line">            <span class="var type0" id="S14T0U1451">Index</span> = <span class="var type0" id="S14T0U1453">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,298" id="srcline298">298</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,299" id="srcline299">299</a></span><span class="line">        <span class="keyword">if</span> <span class="var type0" id="S14T0U1458">Index</span> &lt; <span class="var type0" id="S53T0U1459">M_Len</span>    <span class="comment">% grab refernce haeart rate for this peripheral</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,300" id="srcline300">300</a></span><span class="line">            <span class="var type0" id="S92T0U1463">a_AppTimestamp</span>(<span class="var type0" id="S57T0U1464">count</span>) =  <span class="var type0" id="S25T0U1466">Timestamp</span>(<span class="var type0" id="S14T0U1467">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,301" id="srcline301">301</a></span><span class="line">            <span class="var type0" id="S93T0U1471">a_AX</span>(<span class="var type0" id="S57T0U1472">count</span>) = <span class="var type0" id="S32T0U1474">AX</span>(<span class="var type0" id="S14T0U1475">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,302" id="srcline302">302</a></span><span class="line">            <span class="var type0" id="S94T0U1479">a_AY</span>(<span class="var type0" id="S57T0U1480">count</span>) = <span class="var type0" id="S34T0U1482">AY</span>(<span class="var type0" id="S14T0U1483">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,303" id="srcline303">303</a></span><span class="line">            <span class="var type0" id="S95T0U1487">a_AZ</span>(<span class="var type0" id="S57T0U1488">count</span>) = <span class="var type0" id="S35T0U1490">AZ</span>(<span class="var type0" id="S14T0U1491">Index</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,304" id="srcline304">304</a></span><span class="line">            <span class="var type0" id="S96T0U1495">Accel</span>(<span class="var type0" id="S57T0U1496">count</span>)  =  norm([(<span class="var type0" id="S32T0U1503">AX</span>(<span class="var type0" id="S14T0U1504">Index</span>)) (<span class="var type0" id="S34T0U1507">AY</span>(<span class="var type0" id="S14T0U1508">Index</span>)) (<span class="var type0" id="S35T0U1511">AZ</span>(<span class="var type0" id="S14T0U1512">Index</span>))]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,305" id="srcline305">305</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,306" id="srcline306">306</a></span><span class="line">            <span class="keyword">if</span> (<span class="var type0" id="S57T0U1517">count</span> &gt; 1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,307" id="srcline307">307</a></span><span class="line">                <span class="keyword">if</span> (uint32(<span class="var type0" id="S36T0U1527">AccTimestamp</span>(<span class="var type0" id="S14T0U1528">Index</span>)) + <span class="var type0" id="S58T0U1530">Wraps</span>*2^16) &lt; <span class="var type0" id="S98T0U1535">a_SensorTimestamp</span>(<span class="var type0" id="S57T0U1537">count</span>-1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,308" id="srcline308">308</a></span><span class="line">                    <span class="var type0" id="S58T0U1541">Wraps</span> = <span class="var type0" id="S58T0U1543">Wraps</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,309" id="srcline309">309</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,310" id="srcline310">310</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,311" id="srcline311">311</a></span><span class="line">            <span class="var type0" id="S98T0U1548">a_SensorTimestamp</span>(<span class="var type0" id="S57T0U1549">count</span>) = uint32(<span class="var type0" id="S36T0U1554">AccTimestamp</span>(<span class="var type0" id="S14T0U1555">Index</span>)) + <span class="var type0" id="S58T0U1557">Wraps</span>*2^16;</span></span>
<span class="srcline"><span class="lineno"><a href="1,312" id="srcline312">312</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,313" id="srcline313">313</a></span><span class="line">            <span class="var type0" id="S57T0U1563">count</span> = <span class="var type0" id="S57T0U1565">count</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,314" id="srcline314">314</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,315" id="srcline315">315</a></span><span class="line">        <span class="var type0" id="S14T0U1569">Index</span> = <span class="var type0" id="S14T0U1571">Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,316" id="srcline316">316</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,317" id="srcline317">317</a></span><span class="line">    <span class="var type0" id="S99T0U1575">a_Len</span> = <span class="var type0" id="S57T0U1577">count</span> - 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,318" id="srcline318">318</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line">    <span class="comment">%% begin processing signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">    <span class="var type0" id="S100T0U1581">PreviousNumberOfLEDPulses</span>   = uint8(0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line">    <span class="var type0" id="S101T0U1587">MovingPRMemory</span>         = single(0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line">    <span class="var type0" id="S102T0U1593">PulseRateHistory</span>            = zeros([5,1],<span class="string">'uint8'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line">    <span class="var type0" id="S103T0U1603">PulseRatePointer</span>            = uint8(1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line">    <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line">        <span class="comment">% These are New signals the PPG algorithm will use and create</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">        FilteredDataInput           = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">        PreviousInputVal            = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line">        Quadrant                    = zeros([p_Len,1],<span class="string">'uint8'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">        PreviousQTime               = zeros([p_Len,4],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line">        LocalHigh                   = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">        LocalLow                    = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line">        Threshold                   = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line">        <span class="comment">%Timestamp                   = zeros([p_Len,1],'single');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line">        PreviousTimestamp           = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line">        RawSensorSum                = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">        MatlabPulseRate             = zeros([p_Len,1],<span class="string">'uint8'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line">        MatlabMeanPulseRate         = zeros([p_Len,1],<span class="string">'single'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line">    fprintf(<span class="string">'%d Valid SlotA datapoints (~%0.0f Seconds)\n'</span>,<span class="var type0" id="S71T0U1724">p_Len</span>,<span class="var type0" id="S71T0U1726">p_Len</span>/25);</span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line">    fprintf(<span class="string">'processing SlotA signal for heart rate<span class="keyword">...</span>\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line">    <span class="keyword">for</span> <span class="var type0" id="S104T0U1734">Time</span> = 1:<span class="var type0" id="S71T0U1737">p_Len</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line">        <span class="comment">% sum the 4 raw photodiode values</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line">        <span class="var type0" id="S105T0U1741">RawSensorSum</span>(<span class="var type0" id="S104T0U1742">Time</span>) =   single(<span class="var type0" id="S61T0U1749">p_SlotA_PD1</span>(<span class="var type0" id="S104T0U1750">Time</span>))<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line">            + single(<span class="var type0" id="S62T0U1754">p_SlotA_PD2</span>(<span class="var type0" id="S104T0U1755">Time</span>))<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line">            + single(<span class="var type0" id="S63T0U1759">p_SlotA_PD3</span>(<span class="var type0" id="S104T0U1760">Time</span>))<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line">            + single(<span class="var type0" id="S64T0U1764">p_SlotA_PD4</span>(<span class="var type0" id="S104T0U1765">Time</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line">        <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line">            PPG_struct.Timestamp = p_SlotA_Timestamp(Time);</span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line">            [PPG_struct, Filt_struct] = Process_NewPPGData( <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line">                RawSensorSum(Time),p_NumberLEDPulses(Time), <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line">                PPG_struct, Filt_struct);</span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line">            <span class="comment">% store changes in array for later analysis</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line">            FilteredDataInput(Time)  = PPG_struct.FilteredDataInput;</span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line">            PreviousInputVal(Time)   = PPG_struct.PreviousInputVal;</span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line">            Quadrant(Time)           = PPG_struct.Quadrant;</span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line">            PreviousQTime(Time,1:4)  = PPG_struct.PreviousQTime(1:4);</span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line">            LocalHigh(Time)          = PPG_struct.LocalHigh;</span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line">            LocalLow(Time)           = PPG_struct.LocalLow;</span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line">            Threshold(Time)          = PPG_struct.Threshold;</span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line">            PreviousTimestamp(Time)  = PPG_struct.PreviousTimestamp;</span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line">            MatlabPulseRate(Time)    = PPG_struct.PulseRate;</span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line">            MatlabMeanPulseRate(Time)= PPG_struct.MeanPulseRate;</span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,384" id="srcline384">384</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,385" id="srcline385">385</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% of signal processing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,386" id="srcline386">386</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,387" id="srcline387">387</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,388" id="srcline388">388</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,389" id="srcline389">389</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,390" id="srcline390">390</a></span><span class="line">    <span class="comment">%% Data Analaysis</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,391" id="srcline391">391</a></span><span class="line">    fprintf(<span class="string">'\nGenerating plots<span class="keyword">...</span>\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,392" id="srcline392">392</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,393" id="srcline393">393</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,394" id="srcline394">394</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,395" id="srcline395">395</a></span><span class="line">    figure(29);clf;</span></span>
<span class="srcline"><span class="lineno"><a href="1,396" id="srcline396">396</a></span><span class="line">    <span class="comment">%Analyize data integrity.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,397" id="srcline397">397</a></span><span class="line">    <span class="comment">% This section looks at Timestamp consistancy of SlotA</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,398" id="srcline398">398</a></span><span class="line">    <span class="var type0" id="S108T0U1892">p_SensorTimestampDelta</span> = zeros(1,<span class="var type0" id="S71T0U1897">p_Len</span>-1,<span class="string">'double'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,399" id="srcline399">399</a></span><span class="line">    <span class="keyword">for</span> <span class="var type0" id="S82T0U1902">i</span> = 2:<span class="var type0" id="S71T0U1905">p_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,400" id="srcline400">400</a></span><span class="line">        <span class="var type0" id="S108T0U1909">p_SensorTimestampDelta</span>(<span class="var type0" id="S82T0U1911">i</span>-1) = <span class="var type0" id="S68T0U1915">p_SensorTimestamp</span>(<span class="var type0" id="S82T0U1916">i</span>)- <span class="var type0" id="S68T0U1918">p_SensorTimestamp</span>(<span class="var type0" id="S82T0U1920">i</span>-1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,401" id="srcline401">401</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,402" id="srcline402">402</a></span><span class="line">    <span class="var type0" id="S109T0U1924">Factor</span> = mode(<span class="var type0" id="S108T0U1927">p_SensorTimestampDelta</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,403" id="srcline403">403</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U1935">p_SensorTimestamp</span>(2:end))/32000,<span class="var type0" id="S108T0U1942">p_SensorTimestampDelta</span>/<span class="var type0" id="S109T0U1943">Factor</span>,<span class="string">'b.'</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,404" id="srcline404">404</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U1955">p_SensorTimestamp</span>(2:end))/32000,ones(1,<span class="var type0" id="S71T0U1967">p_Len</span>-1)*mean(<span class="var type0" id="S108T0U1971">p_SensorTimestampDelta</span>)/<span class="var type0" id="S109T0U1972">Factor</span>,<span class="string">'r--'</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,405" id="srcline405">405</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U1984">p_SensorTimestamp</span>(2:end))/32000,ones(1,<span class="var type0" id="S71T0U1996">p_Len</span>-1)*median(<span class="var type0" id="S108T0U2000">p_SensorTimestampDelta</span>)/<span class="var type0" id="S109T0U2001">Factor</span>,<span class="string">'k--'</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,406" id="srcline406">406</a></span><span class="line">    <span class="comment">%plot(1:(p_Len-1),ones(1,p_Len-1)*mode(p_SlotA_TimestampDelta),'m--');hold on</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,407" id="srcline407">407</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2013">p_SensorTimestamp</span>(2:end)/32000),ones(1,<span class="var type0" id="S71T0U2026">p_Len</span>-1)*32000/26/<span class="var type0" id="S109T0U2030">Factor</span>,<span class="string">'g--'</span>,<span class="string">'LineWidth'</span>,1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,408" id="srcline408">408</a></span><span class="line">    ylim([0 5]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,409" id="srcline409">409</a></span><span class="line">    legend(<span class="string">'TimeStamp Delta'</span>,<span class="string">'Mean'</span>,<span class="string">'Median'</span>,<span class="string">'Mode'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,410" id="srcline410">410</a></span><span class="line">    title(<span class="string">'SlotA Timestamp Delta vs. Time'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,411" id="srcline411">411</a></span><span class="line">    xlabel(<span class="string">'seconds'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,412" id="srcline412">412</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,413" id="srcline413">413</a></span><span class="line">    <span class="comment">%Plot PPG Waveform</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,414" id="srcline414">414</a></span><span class="line">    figure(30);clf;</span></span>
<span class="srcline"><span class="lineno"><a href="1,415" id="srcline415">415</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2069">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S61T0U2071">p_SlotA_PD1</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,416" id="srcline416">416</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2081">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S62T0U2083">p_SlotA_PD2</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,417" id="srcline417">417</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2093">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S63T0U2095">p_SlotA_PD3</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,418" id="srcline418">418</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2105">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S64T0U2107">p_SlotA_PD4</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,419" id="srcline419">419</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2117">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S105T0U2120">RawSensorSum</span>/4);</span></span>
<span class="srcline"><span class="lineno"><a href="1,420" id="srcline420">420</a></span><span class="line">    legend(<span class="string">'PD1'</span>,<span class="string">'PD2'</span>,<span class="string">'PD3'</span>,<span class="string">'PD4'</span>,<span class="string">'Sum/4'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,421" id="srcline421">421</a></span><span class="line">    xlabel(<span class="string">'seconds'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,422" id="srcline422">422</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,423" id="srcline423">423</a></span><span class="line">    <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,424" id="srcline424">424</a></span><span class="line">        figure(31);clf;</span></span>
<span class="srcline"><span class="lineno"><a href="1,425" id="srcline425">425</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,FilteredDataInput, <span class="string">'r'</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,426" id="srcline426">426</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,Threshold,<span class="string">'g'</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,427" id="srcline427">427</a></span><span class="line">        title(<span class="string">'PPG Signals'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,428" id="srcline428">428</a></span><span class="line">        set(gca,<span class="string">'YGrid'</span>,<span class="string">'on'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,429" id="srcline429">429</a></span><span class="line">        legend(<span class="string">'FilteredDataInput'</span>,<span class="string">'Threshold'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,430" id="srcline430">430</a></span><span class="line">        xlabel(<span class="string">'seconds'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,431" id="srcline431">431</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,432" id="srcline432">432</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,433" id="srcline433">433</a></span><span class="line">    <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,434" id="srcline434">434</a></span><span class="line">        figure(32);clf;</span></span>
<span class="srcline"><span class="lineno"><a href="1,435" id="srcline435">435</a></span><span class="line">        <span class="comment">%plotyy(1:p_Len,p_NumberLEDPulses,1:p_Len,p_Stillness);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,436" id="srcline436">436</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,p_NumberLEDPulses);</span></span>
<span class="srcline"><span class="lineno"><a href="1,437" id="srcline437">437</a></span><span class="line">        title(<span class="string">'LED Pulses'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,438" id="srcline438">438</a></span><span class="line">        xlabel(<span class="string">'seconds'</span>);ylabel(<span class="string">'Number of LED Pulses'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,439" id="srcline439">439</a></span><span class="line">        legend(<span class="string">'NumberLEDPulses'</span>); <span class="comment">%,'Stillness');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,440" id="srcline440">440</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,441" id="srcline441">441</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,442" id="srcline442">442</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,443" id="srcline443">443</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,444" id="srcline444">444</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,445" id="srcline445">445</a></span><span class="line">    figure(35);clf;title(<span class="string">'All Pulse Rates'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,446" id="srcline446">446</a></span><span class="line">    <span class="var type0" id="S121T0U2235">Pink</span> =  [1 .75 .75];</span></span>
<span class="srcline"><span class="lineno"><a href="1,447" id="srcline447">447</a></span><span class="line">    <span class="var type0" id="S122T0U2243">DPink</span> = [1 .5 .5];</span></span>
<span class="srcline"><span class="lineno"><a href="1,448" id="srcline448">448</a></span><span class="line">    <span class="var type0" id="S123T0U2251">DGrn</span> =  [0 .65 0];</span></span>
<span class="srcline"><span class="lineno"><a href="1,449" id="srcline449">449</a></span><span class="line">    <span class="var type0" id="S124T0U2259">LegendText</span> = {};<span class="var type0" id="S125T0U2264">LegendCount</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,450" id="srcline450">450</a></span><span class="line">    <span class="comment">% SENtral Calc</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,451" id="srcline451">451</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2272">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S67T0U2274">p_MeanHeartPulseRate</span>,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,18);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,452" id="srcline452">452</a></span><span class="line">    <span class="var type0" id="S125T0U2283">LegendCount</span> = <span class="var type0" id="S125T0U2285">LegendCount</span> + 1; <span class="var type0" id="S124T0U2290">LegendText</span>{<span class="var type0" id="S125T0U2291">LegendCount</span>} =  <span class="string">'SENtral MeanQ'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,453" id="srcline453">453</a></span><span class="line">    <span class="keyword">if</span> 0 <span class="comment">% from SENtral Calc</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,454" id="srcline454">454</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,p_Raw_PulseRate,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,6,<span class="string">'MarkerFaceColor'</span>,Pink,<span class="string">'MarkerEdgeColor'</span>,Pink);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,455" id="srcline455">455</a></span><span class="line">        LegendCount = LegendCount + 1; LegendText{LegendCount} =  <span class="string">'SENtral Raw'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,456" id="srcline456">456</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,457" id="srcline457">457</a></span><span class="line">    <span class="keyword">if</span> 0 <span class="comment">% from Matlab calc (this run)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,458" id="srcline458">458</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,MatlabMeanPulseRate,<span class="string">'b.'</span>,<span class="string">'MarkerSize'</span>,18);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,459" id="srcline459">459</a></span><span class="line">        LegendCount = LegendCount + 1; LegendText{LegendCount} =  <span class="string">'Matlab MeanQ'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,460" id="srcline460">460</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,461" id="srcline461">461</a></span><span class="line">    <span class="keyword">if</span> <span class="var type0" id="S86T0U2360">RefNum</span> &gt; 0  <span class="comment">% from Reference Sensor(s)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,462" id="srcline462">462</a></span><span class="line">        plot(single(<span class="var type0" id="S89T0U2369">r_SensorTimestamp</span>(1,:))/32000,<span class="var type0" id="S91T0U2374">r_RefHeartPulseRate</span>(1,:),<span class="string">'g.'</span>,<span class="string">'MarkerSize'</span>,18);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,463" id="srcline463">463</a></span><span class="line">        <span class="var type0" id="S125T0U2385">LegendCount</span> = <span class="var type0" id="S125T0U2387">LegendCount</span> + 1; <span class="var type0" id="S124T0U2392">LegendText</span>{<span class="var type0" id="S125T0U2393">LegendCount</span>} =  <span class="var type0" id="S83T0U2395">RefPeripherals</span>{1};</span></span>
<span class="srcline"><span class="lineno"><a href="1,464" id="srcline464">464</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,465" id="srcline465">465</a></span><span class="line">    <span class="keyword">if</span> <span class="var type0" id="S86T0U2400">RefNum</span> == 2</span></span>
<span class="srcline"><span class="lineno"><a href="1,466" id="srcline466">466</a></span><span class="line">        plot(single(<span class="var type0" id="S89T0U2409">r_SensorTimestamp</span>(2,:))/32000,<span class="var type0" id="S91T0U2414">r_RefHeartPulseRate</span>(2,:),<span class="string">'.'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="var type0" id="S123T0U2419">DGrn</span>,<span class="string">'MarkerEdgeColor'</span>,<span class="var type0" id="S123T0U2421">DGrn</span>);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,467" id="srcline467">467</a></span><span class="line">        <span class="var type0" id="S125T0U2427">LegendCount</span> = <span class="var type0" id="S125T0U2429">LegendCount</span> + 1; <span class="var type0" id="S124T0U2434">LegendText</span>{<span class="var type0" id="S125T0U2435">LegendCount</span>} =  <span class="var type0" id="S83T0U2437">RefPeripherals</span>{2};</span></span>
<span class="srcline"><span class="lineno"><a href="1,468" id="srcline468">468</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,469" id="srcline469">469</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,470" id="srcline470">470</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,471" id="srcline471">471</a></span><span class="line">    <span class="var type0" id="S126T0U2441">PrintQNumber</span> = 0;  <span class="comment">% True/false</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,472" id="srcline472">472</a></span><span class="line">    <span class="keyword">if</span> (<span class="var type0" id="S126T0U2446">PrintQNumber</span>) <span class="comment">% if true (==1) then highlight Quadrant 1 values</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,473" id="srcline473">473</a></span><span class="line">        <span class="keyword">for</span> <span class="var type0" id="S82T0U2449">i</span> = 1:<span class="var type0" id="S71T0U2452">p_Len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,474" id="srcline474">474</a></span><span class="line">            <span class="keyword">if</span> (Quadrant(<span class="var type0" id="S82T0U2459">i</span>) &gt;4) <span class="comment">% from ~=1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,475" id="srcline475">475</a></span><span class="line">                <span class="var type0" id="S128T0U2464">RawPulseRateQ1</span>(<span class="var type0" id="S82T0U2465">i</span>) = 0;   <span class="comment">% clear these out of the way</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,476" id="srcline476">476</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,477" id="srcline477">477</a></span><span class="line">                <span class="var type0" id="S128T0U2471">RawPulseRateQ1</span>(<span class="var type0" id="S82T0U2472">i</span>) = MatlabPulseRate(<span class="var type0" id="S82T0U2475">i</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,478" id="srcline478">478</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,479" id="srcline479">479</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,480" id="srcline480">480</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,481" id="srcline481">481</a></span><span class="line">        plot(double(<span class="var type0" id="S68T0U2482">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S128T0U2484">RawPulseRateQ1</span>,<span class="string">'.'</span>,<span class="string">'MarkerSize'</span>,10,<span class="string">'MarkerFaceColor'</span>,<span class="var type0" id="S122T0U2489">DPink</span>,<span class="string">'MarkerEdgeColor'</span>,<span class="var type0" id="S122T0U2491">DPink</span>); hold <span class="string">on</span>;    <span class="comment">% from Matlab calc (this run)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,482" id="srcline482">482</a></span><span class="line">        <span class="var type0" id="S125T0U2497">LegendCount</span> = <span class="var type0" id="S125T0U2499">LegendCount</span> + 1; <span class="var type0" id="S124T0U2504">LegendText</span>{<span class="var type0" id="S125T0U2505">LegendCount</span>} =  <span class="string">'Raw-Q1'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,483" id="srcline483">483</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,484" id="srcline484">484</a></span><span class="line">    plot(double(<span class="var type0" id="S68T0U2513">p_SensorTimestamp</span>)/32000,<span class="var type0" id="S65T0U2515">p_NumberLEDPulses</span>,<span class="string">'c-'</span>); hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,485" id="srcline485">485</a></span><span class="line">    <span class="var type0" id="S125T0U2522">LegendCount</span> = <span class="var type0" id="S125T0U2524">LegendCount</span> + 1; <span class="var type0" id="S124T0U2529">LegendText</span>{<span class="var type0" id="S125T0U2530">LegendCount</span>} =  <span class="string">'LED Pulses'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,486" id="srcline486">486</a></span><span class="line">    plot(double(<span class="var type0" id="S98T0U2538">a_SensorTimestamp</span>)/32000,<span class="var type0" id="S96T0U2541">Accel</span>*10,<span class="string">'k-'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,487" id="srcline487">487</a></span><span class="line">    <span class="var type0" id="S125T0U2546">LegendCount</span> = <span class="var type0" id="S125T0U2548">LegendCount</span> + 1; <span class="var type0" id="S124T0U2553">LegendText</span>{<span class="var type0" id="S125T0U2554">LegendCount</span>} =  <span class="string">'Accel(10xRSS)'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,488" id="srcline488">488</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,489" id="srcline489">489</a></span><span class="line">    legend(<span class="var type0" id="S124T0U2559">LegendText</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,490" id="srcline490">490</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,491" id="srcline491">491</a></span><span class="line">    <span class="comment">%ylim([0 120]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,492" id="srcline492">492</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,493" id="srcline493">493</a></span><span class="line">    <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,494" id="srcline494">494</a></span><span class="line">        i = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,495" id="srcline495">495</a></span><span class="line">        <span class="keyword">while</span> i &lt; p_Len</span></span>
<span class="srcline"><span class="lineno"><a href="1,496" id="srcline496">496</a></span><span class="line">            <span class="keyword">if</span> (Quadrant(i) &lt;5) <span class="comment">% from =1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,497" id="srcline497">497</a></span><span class="line">                TempPulseRate = MatlabPulseRate(i);index = i;</span></span>
<span class="srcline"><span class="lineno"><a href="1,498" id="srcline498">498</a></span><span class="line">                <span class="keyword">while</span> and(i &lt; p_Len,Quadrant(i) == 1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,499" id="srcline499">499</a></span><span class="line">                    i = i + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,500" id="srcline500">500</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,501" id="srcline501">501</a></span><span class="line">                text(double(p_SensorTimestamp(index))/32000,double(TempPulseRate),[<span class="string">'  '</span> num2str(floor(LocalHigh(i)-LocalLow(i)))],<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,502" id="srcline502">502</a></span><span class="line">                    <span class="string">'FontSize'</span>,8,<span class="string">'Rotation'</span>,-90,<span class="string">'Color'</span>,[.9 .8 .8]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,503" id="srcline503">503</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,504" id="srcline504">504</a></span><span class="line">            i = i + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,505" id="srcline505">505</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,506" id="srcline506">506</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,507" id="srcline507">507</a></span><span class="line">    xlabel(<span class="string">'seconds'</span>);ylabel(<span class="string">'Pulse Rate (BPM)'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,508" id="srcline508">508</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,509" id="srcline509">509</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,510" id="srcline510">510</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,511" id="srcline511">511</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,512" id="srcline512">512</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,513" id="srcline513">513</a></span><span class="line">    <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,514" id="srcline514">514</a></span><span class="line">        figure(40);clf;</span></span>
<span class="srcline"><span class="lineno"><a href="1,515" id="srcline515">515</a></span><span class="line">        <span class="comment">%[AX,H1,H2] = plotyy(<span class="keyword">...</span><span class="comment">) returns the handles of the two axes created in AX</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,516" id="srcline516">516</a></span><span class="line">        <span class="comment">%  and the handles of the graphics objects from each plot in H1 and H2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,517" id="srcline517">517</a></span><span class="line">        <span class="comment">%  AX(1) is the left axes and AX(2) is the right axes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,518" id="srcline518">518</a></span><span class="line">        [PX,Y1,Y2] = plotyy(double(p_SensorTimestamp)/32000,[FilteredDataInput,LocalHigh,LocalLow,Threshold],<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,519" id="srcline519">519</a></span><span class="line">            double(p_SensorTimestamp)/32000,[Quadrant*50,MatlabPulseRate]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,520" id="srcline520">520</a></span><span class="line">        <span class="comment">%[PX,Y1,Y2] = plotyy(1:p_Len,[FilteredDataInput,LocalHigh,LocalLow,Threshold],<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,521" id="srcline521">521</a></span><span class="line">        <span class="comment">%                    1:p_Len,[Quadrant*50,MatlabPulseRate]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,522" id="srcline522">522</a></span><span class="line">        set(Y1(1) ,<span class="string">'Color'</span>,<span class="string">'k'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,523" id="srcline523">523</a></span><span class="line">        set(Y1(2) ,<span class="string">'Color'</span>,[1 .5 .5]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,524" id="srcline524">524</a></span><span class="line">        set(Y1(3) ,<span class="string">'Color'</span>,[.5 .5 1]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,525" id="srcline525">525</a></span><span class="line">        set(Y1(4) ,<span class="string">'Color'</span>,[.5 1 .5]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,526" id="srcline526">526</a></span><span class="line">        set(Y2(1) ,<span class="string">'Color'</span>,<span class="string">'b'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,527" id="srcline527">527</a></span><span class="line">        set(Y2(2) ,<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'linestyle'</span>,<span class="string">'none'</span>,<span class="string">'marker'</span>,<span class="string">'o'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,528" id="srcline528">528</a></span><span class="line">        title(<span class="string">'PPG Algorithm Signals'</span>);xlabel(<span class="string">'seconds'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,529" id="srcline529">529</a></span><span class="line">        set(PX,<span class="string">'YGrid'</span>,<span class="string">'on'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,530" id="srcline530">530</a></span><span class="line">        yscale = max(FilteredDataInput)-min(FilteredDataInput);</span></span>
<span class="srcline"><span class="lineno"><a href="1,531" id="srcline531">531</a></span><span class="line">        overlap = .25; <span class="comment">% separate axes on same plot with this much overlap</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,532" id="srcline532">532</a></span><span class="line">        set(PX(1),<span class="string">'ylim'</span>,[(overlap-2)*yscale+min(FilteredDataInput),max(FilteredDataInput)]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,533" id="srcline533">533</a></span><span class="line">        set(PX(2),<span class="string">'ylim'</span>,[0,(2-overlap)*single(max(MatlabPulseRate))]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,534" id="srcline534">534</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,535" id="srcline535">535</a></span><span class="line">        <span class="keyword">for</span> i = 1:p_Len</span></span>
<span class="srcline"><span class="lineno"><a href="1,536" id="srcline536">536</a></span><span class="line">            <span class="keyword">if</span> (MatlabPulseRate(i) &gt; 30) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,537" id="srcline537">537</a></span><span class="line">                    &amp;&amp; (MatlabPulseRate(i) &lt; 200)<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,538" id="srcline538">538</a></span><span class="line">                    &amp;&amp; (Quadrant(i) &lt; 3)</span></span>
<span class="srcline"><span class="lineno"><a href="1,539" id="srcline539">539</a></span><span class="line">                <span class="comment">%      text(i,double(MatlabPulseRate(i)),int2str(Quadrant(i)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,540" id="srcline540">540</a></span><span class="line">                text(double(p_SensorTimestamp(i))/32000,double(MatlabPulseRate(i))-6,int2str(Quadrant(i)),<span class="string">'parent'</span>,PX(2));</span></span>
<span class="srcline"><span class="lineno"><a href="1,541" id="srcline541">541</a></span><span class="line">                <span class="keyword">if</span> (Quadrant(i) == 1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,542" id="srcline542">542</a></span><span class="line">                    text(double(p_SensorTimestamp(i))/32000,double(MatlabPulseRate(i))+6,[<span class="string">'HPR:'</span> int2str(MatlabPulseRate(i))],<span class="string">'parent'</span>,PX(2));</span></span>
<span class="srcline"><span class="lineno"><a href="1,543" id="srcline543">543</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,544" id="srcline544">544</a></span><span class="line">                    text(double(p_SensorTimestamp(i))/32000,double(MatlabPulseRate(i))+6,int2str([LocalHigh(i) LocalLow(i)]),<span class="string">'parent'</span>,PX(2));</span></span>
<span class="srcline"><span class="lineno"><a href="1,545" id="srcline545">545</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,546" id="srcline546">546</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,547" id="srcline547">547</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,548" id="srcline548">548</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,549" id="srcline549">549</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,550" id="srcline550">550</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,551" id="srcline551">551</a></span><span class="line">    <span class="keyword">if</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,552" id="srcline552">552</a></span><span class="line">        figure(41);clf</span></span>
<span class="srcline"><span class="lineno"><a href="1,553" id="srcline553">553</a></span><span class="line">        LegendText = {};LegendCount = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,554" id="srcline554">554</a></span><span class="line">        <span class="keyword">if</span> RefNum &gt; 0</span></span>
<span class="srcline"><span class="lineno"><a href="1,555" id="srcline555">555</a></span><span class="line">            plot(double(r_SensorTimestamp(1,:))/32000,r_RefHeartPulseRate(1,:),<span class="string">'g.'</span>,<span class="string">'MarkerSize'</span>,18);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,556" id="srcline556">556</a></span><span class="line">            LegendCount = LegendCount + 1; LegendText{LegendCount} =  RefPeripherals{1};</span></span>
<span class="srcline"><span class="lineno"><a href="1,557" id="srcline557">557</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,558" id="srcline558">558</a></span><span class="line">        <span class="comment">% from Matlab calc (this run)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,559" id="srcline559">559</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,MatlabMeanPulseRate,<span class="string">'b.'</span>,<span class="string">'MarkerSize'</span>,18);hold <span class="string">on</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,560" id="srcline560">560</a></span><span class="line">        plot(double(p_SensorTimestamp)/32000,MatlabPulseRate,<span class="string">'ro'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,561" id="srcline561">561</a></span><span class="line">        <span class="comment">%[PX,Y1,Y2] = plotyy(1:p_Len,[FilteredDataInput,LocalHigh,LocalLow,Threshold],<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,562" id="srcline562">562</a></span><span class="line">        <span class="comment">%                    1:p_Len,[Quadrant*50,MatlabPulseRate]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,563" id="srcline563">563</a></span><span class="line">        title(<span class="string">'PPG Algorithm Signals'</span>);xlabel(<span class="string">'seconds'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,564" id="srcline564">564</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,565" id="srcline565">565</a></span><span class="line">        <span class="keyword">for</span> i = 1:p_Len</span></span>
<span class="srcline"><span class="lineno"><a href="1,566" id="srcline566">566</a></span><span class="line">            <span class="keyword">if</span> (MatlabPulseRate(i) &gt;20) <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,567" id="srcline567">567</a></span><span class="line">                    &amp;&amp; (MatlabPulseRate(i) &lt; 250)<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,568" id="srcline568">568</a></span><span class="line">                    &amp;&amp; (Quadrant(i) &lt; 5)</span></span>
<span class="srcline"><span class="lineno"><a href="1,569" id="srcline569">569</a></span><span class="line">                <span class="comment">%      text(i,double(MatlabPulseRate(i)),int2str(Quadrant(i)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,570" id="srcline570">570</a></span><span class="line">                text(double(p_SensorTimestamp(i))/32000-1,double(MatlabPulseRate(i))-0,int2str(Quadrant(i)));</span></span>
<span class="srcline"><span class="lineno"><a href="1,571" id="srcline571">571</a></span><span class="line">                <span class="comment">%       if (Quadrant(i) == 1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,572" id="srcline572">572</a></span><span class="line">                <span class="comment">%         text(double(p_SensorTimestamp(i))/32000,double(MatlabPulseRate(i))+6,['HPR:' int2str(MatlabPulseRate(i))]);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,573" id="srcline573">573</a></span><span class="line">                <span class="comment">%       else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,574" id="srcline574">574</a></span><span class="line">                <span class="comment">%         text(double(p_SensorTimestamp(i))/32000,double(MatlabPulseRate(i))+6,int2str([LocalHigh(i) LocalLow(i)]));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,575" id="srcline575">575</a></span><span class="line">                <span class="comment">%       end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,576" id="srcline576">576</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="1,577" id="srcline577">577</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,578" id="srcline578">578</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,579" id="srcline579">579</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,580" id="srcline580">580</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,581" id="srcline581">581</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,582" id="srcline582">582</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,583" id="srcline583">583</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,584" id="srcline584">584</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,585" id="srcline585">585</a></span><span class="line">    <span class="comment">% Create ADI Style Datalog</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,586" id="srcline586">586</a></span><span class="line">    <span class="var type0" id="S131T0U3099">ADI_Filename</span> = <span class="string">'SENtrodeDataLogOut-ADI.csv'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,587" id="srcline587">587</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,588" id="srcline588">588</a></span><span class="line">    <span class="keyword">if</span> (<span class="var type0" id="S80T0U3105">NumberOfRefs</span> == 1)</span></span>
<span class="srcline"><span class="lineno"><a href="1,589" id="srcline589">589</a></span><span class="line">        <span class="var type0" id="S132T0U3109">fn</span> = fopen(<span class="var type0" id="S131T0U3112">ADI_Filename</span>,<span class="string">'w'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,590" id="srcline590">590</a></span><span class="line">        fprintf(<span class="var type0" id="S132T0U3117">fn</span>,<span class="string">'Timestamp(seconds),peripheral,heartrate,ax,ay,az,SLOTA_PD1,SLOTA_PD2,SLOTA_PD3,SLOTA_PD4,led_Pulses,SLOTB_PD1,SLOTB_PD2,SLOTB_PD3,SLOTB_PD4\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,591" id="srcline591">591</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,592" id="srcline592">592</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,593" id="srcline593">593</a></span><span class="line">        <span class="var type0" id="S133T0U3121">p_Index</span> = 1; <span class="var type0" id="S134T0U3125">pb_Index</span> = 1; <span class="var type0" id="S135T0U3129">a_Index</span> =  1; <span class="var type0" id="S136T0U3133">r_Index1</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,594" id="srcline594">594</a></span><span class="line">        <span class="keyword">while</span>( <span class="var type0" id="S133T0U3140">p_Index</span> &lt; <span class="var type0" id="S71T0U3141">p_Len</span> &amp;&amp; <span class="var type0" id="S134T0U3143">pb_Index</span> &lt; <span class="var type0" id="S79T0U3144">pb_Len</span> &amp;&amp; <span class="var type0" id="S136T0U3146">r_Index1</span> &lt; <span class="var type0" id="S84T0U3148">r_Len</span>(1) )</span></span>
<span class="srcline"><span class="lineno"><a href="1,595" id="srcline595">595</a></span><span class="line">            [<span class="var type0" id="S137T0U3153">N</span>,<span class="var type0" id="S138T0U3154">SortIndex</span>] = sort([ <span class="var type0" id="S68T0U3160">p_SensorTimestamp</span>(<span class="var type0" id="S133T0U3161">p_Index</span>)  <span class="var type0" id="S78T0U3163">pb_SensorTimestamp</span>(<span class="var type0" id="S134T0U3164">pb_Index</span>) <span class="var type0" id="S98T0U3166">a_SensorTimestamp</span>(<span class="var type0" id="S135T0U3167">a_Index</span>) <span class="var type0" id="S89T0U3169">r_SensorTimestamp</span>(1,<span class="var type0" id="S136T0U3171">r_Index1</span>) ]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,596" id="srcline596">596</a></span><span class="line">            <span class="keyword">switch</span> (<span class="var type0" id="S138T0U3175">SortIndex</span>(1))  <span class="comment">% print record with the lowest Timestamp on next line</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,597" id="srcline597">597</a></span><span class="line">                <span class="keyword">case</span> 1 <span class="comment">%Slot A</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,598" id="srcline598">598</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3182">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,599" id="srcline599">599</a></span><span class="line">                        double(<span class="var type0" id="S68T0U3188">p_SensorTimestamp</span>(<span class="var type0" id="S133T0U3189">p_Index</span>))/32000,<span class="string">'ADPD173_SlotA'</span>,<span class="var type0" id="S67T0U3193">p_MeanHeartPulseRate</span>(<span class="var type0" id="S133T0U3194">p_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,600" id="srcline600">600</a></span><span class="line">                        0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,601" id="srcline601">601</a></span><span class="line">                        <span class="var type0" id="S61T0U3199">p_SlotA_PD1</span>(<span class="var type0" id="S133T0U3200">p_Index</span>),<span class="var type0" id="S62T0U3202">p_SlotA_PD2</span>(<span class="var type0" id="S133T0U3203">p_Index</span>),<span class="var type0" id="S63T0U3205">p_SlotA_PD3</span>(<span class="var type0" id="S133T0U3206">p_Index</span>),<span class="var type0" id="S64T0U3208">p_SlotA_PD4</span>(<span class="var type0" id="S133T0U3209">p_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,602" id="srcline602">602</a></span><span class="line">                        <span class="var type0" id="S65T0U3211">p_NumberLEDPulses</span>(<span class="var type0" id="S133T0U3212">p_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,603" id="srcline603">603</a></span><span class="line">                        0,0,0,0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,604" id="srcline604">604</a></span><span class="line">                    <span class="var type0" id="S133T0U3219">p_Index</span> = <span class="var type0" id="S133T0U3221">p_Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,605" id="srcline605">605</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,606" id="srcline606">606</a></span><span class="line">                <span class="keyword">case</span> 2 <span class="comment">%Slot B</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,607" id="srcline607">607</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3228">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,608" id="srcline608">608</a></span><span class="line">                        double(<span class="var type0" id="S78T0U3234">pb_SensorTimestamp</span>(<span class="var type0" id="S134T0U3235">pb_Index</span>))/32000,<span class="string">'ADPD173_SlotB'</span>,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,609" id="srcline609">609</a></span><span class="line">                        0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,610" id="srcline610">610</a></span><span class="line">                        0,0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,611" id="srcline611">611</a></span><span class="line">                        15, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,612" id="srcline612">612</a></span><span class="line">                        <span class="var type0" id="S74T0U3248">pb_SlotB_PD1</span>(<span class="var type0" id="S134T0U3249">pb_Index</span>),<span class="var type0" id="S75T0U3251">pb_SlotB_PD2</span>(<span class="var type0" id="S134T0U3252">pb_Index</span>),<span class="var type0" id="S76T0U3254">pb_SlotB_PD3</span>(<span class="var type0" id="S134T0U3255">pb_Index</span>),<span class="var type0" id="S77T0U3257">pb_SlotB_PD4</span>(<span class="var type0" id="S134T0U3258">pb_Index</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,613" id="srcline613">613</a></span><span class="line">                    <span class="var type0" id="S134T0U3261">pb_Index</span> = <span class="var type0" id="S134T0U3263">pb_Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,614" id="srcline614">614</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,615" id="srcline615">615</a></span><span class="line">                <span class="keyword">case</span> 3 <span class="comment">%Accel</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,616" id="srcline616">616</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3270">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,617" id="srcline617">617</a></span><span class="line">                        double(<span class="var type0" id="S98T0U3276">a_SensorTimestamp</span>(<span class="var type0" id="S135T0U3277">a_Index</span>))/32000,<span class="string">'AccelData'</span>,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,618" id="srcline618">618</a></span><span class="line">                        <span class="var type0" id="S93T0U3282">a_AX</span>(<span class="var type0" id="S135T0U3283">a_Index</span>),<span class="var type0" id="S94T0U3285">a_AY</span>(<span class="var type0" id="S135T0U3286">a_Index</span>),<span class="var type0" id="S95T0U3288">a_AZ</span>(<span class="var type0" id="S135T0U3289">a_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,619" id="srcline619">619</a></span><span class="line">                        0,0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,620" id="srcline620">620</a></span><span class="line">                        0, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,621" id="srcline621">621</a></span><span class="line">                        0,0,0,0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,622" id="srcline622">622</a></span><span class="line">                    <span class="var type0" id="S135T0U3301">a_Index</span> = <span class="var type0" id="S135T0U3303">a_Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,623" id="srcline623">623</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,624" id="srcline624">624</a></span><span class="line">                <span class="keyword">case</span> 4 <span class="comment">%First Refernce HRP meter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,625" id="srcline625">625</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3310">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,626" id="srcline626">626</a></span><span class="line">                        double(<span class="var type0" id="S89T0U3316">r_SensorTimestamp</span>(1,<span class="var type0" id="S136T0U3318">r_Index1</span>))/32000,<span class="var type0" id="S83T0U3321">RefPeripherals</span>{1},<span class="var type0" id="S91T0U3324">r_RefHeartPulseRate</span>(1,<span class="var type0" id="S136T0U3326">r_Index1</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,627" id="srcline627">627</a></span><span class="line">                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,628" id="srcline628">628</a></span><span class="line">                    <span class="var type0" id="S136T0U3341">r_Index1</span> = <span class="var type0" id="S136T0U3343">r_Index1</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,629" id="srcline629">629</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,630" id="srcline630">630</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,631" id="srcline631">631</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,632" id="srcline632">632</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,633" id="srcline633">633</a></span><span class="line">        fclose(<span class="var type0" id="S132T0U3348">fn</span>);clear <span class="string">fn</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,634" id="srcline634">634</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,635" id="srcline635">635</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,636" id="srcline636">636</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,637" id="srcline637">637</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,638" id="srcline638">638</a></span><span class="line">    <span class="keyword">if</span> (<span class="var type0" id="S80T0U3356">NumberOfRefs</span> == 2)  <span class="comment">% Create ADI Style Datalog</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,639" id="srcline639">639</a></span><span class="line">        <span class="var type0" id="S132T0U3360">fn</span> = fopen(<span class="var type0" id="S131T0U3363">ADI_Filename</span>,<span class="string">'w'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,640" id="srcline640">640</a></span><span class="line">        fprintf(<span class="var type0" id="S132T0U3368">fn</span>,<span class="string">'Timestamp(seconds),peripheral,heartrate,ax,ay,az,SLOTA_PD1,SLOTA_PD2,SLOTA_PD3,SLOTA_PD4,led_Pulses,SLOTB_PD1,SLOTB_PD2,SLOTB_PD3,SLOTB_PD4\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,641" id="srcline641">641</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,642" id="srcline642">642</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,643" id="srcline643">643</a></span><span class="line">        <span class="var type0" id="S133T0U3372">p_Index</span> = 1; <span class="var type0" id="S134T0U3376">pb_Index</span> = 1; <span class="var type0" id="S135T0U3380">a_Index</span> =  1; <span class="var type0" id="S136T0U3384">r_Index1</span> = 1; <span class="var type0" id="S140T0U3388">r_Index2</span> = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,644" id="srcline644">644</a></span><span class="line">        <span class="keyword">while</span>( <span class="var type0" id="S133T0U3396">p_Index</span> &lt; <span class="var type0" id="S71T0U3397">p_Len</span> &amp;&amp; <span class="var type0" id="S134T0U3399">pb_Index</span> &lt; <span class="var type0" id="S79T0U3400">pb_Len</span> &amp;&amp; <span class="var type0" id="S136T0U3402">r_Index1</span> &lt; <span class="var type0" id="S84T0U3404">r_Len</span>(1) &amp;&amp; <span class="var type0" id="S140T0U3407">r_Index2</span> &lt; <span class="var type0" id="S84T0U3409">r_Len</span>(2))</span></span>
<span class="srcline"><span class="lineno"><a href="1,645" id="srcline645">645</a></span><span class="line">            [<span class="var type0" id="S137T0U3414">N</span>,<span class="var type0" id="S138T0U3415">SortIndex</span>] = sort([ <span class="var type0" id="S68T0U3421">p_SensorTimestamp</span>(<span class="var type0" id="S133T0U3422">p_Index</span>)  <span class="var type0" id="S78T0U3424">pb_SensorTimestamp</span>(<span class="var type0" id="S134T0U3425">pb_Index</span>) <span class="var type0" id="S98T0U3427">a_SensorTimestamp</span>(<span class="var type0" id="S135T0U3428">a_Index</span>) <span class="var type0" id="S89T0U3430">r_SensorTimestamp</span>(1,<span class="var type0" id="S136T0U3432">r_Index1</span>)  <span class="var type0" id="S89T0U3434">r_SensorTimestamp</span>(2,<span class="var type0" id="S140T0U3436">r_Index2</span>)]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,646" id="srcline646">646</a></span><span class="line">            <span class="keyword">switch</span> (<span class="var type0" id="S138T0U3440">SortIndex</span>(1))  <span class="comment">% print record with the lowest Timestamp on next line</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,647" id="srcline647">647</a></span><span class="line">                <span class="keyword">case</span> 1 <span class="comment">%Slot A</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,648" id="srcline648">648</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3447">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,649" id="srcline649">649</a></span><span class="line">                        double(<span class="var type0" id="S68T0U3453">p_SensorTimestamp</span>(<span class="var type0" id="S133T0U3454">p_Index</span>))/32000,<span class="string">'ADPD173_SlotA'</span>,<span class="var type0" id="S67T0U3458">p_MeanHeartPulseRate</span>(<span class="var type0" id="S133T0U3459">p_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,650" id="srcline650">650</a></span><span class="line">                        0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,651" id="srcline651">651</a></span><span class="line">                        <span class="var type0" id="S61T0U3464">p_SlotA_PD1</span>(<span class="var type0" id="S133T0U3465">p_Index</span>),<span class="var type0" id="S62T0U3467">p_SlotA_PD2</span>(<span class="var type0" id="S133T0U3468">p_Index</span>),<span class="var type0" id="S63T0U3470">p_SlotA_PD3</span>(<span class="var type0" id="S133T0U3471">p_Index</span>),<span class="var type0" id="S64T0U3473">p_SlotA_PD4</span>(<span class="var type0" id="S133T0U3474">p_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,652" id="srcline652">652</a></span><span class="line">                        <span class="var type0" id="S65T0U3476">p_NumberLEDPulses</span>(<span class="var type0" id="S133T0U3477">p_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,653" id="srcline653">653</a></span><span class="line">                        0,0,0,0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,654" id="srcline654">654</a></span><span class="line">                    <span class="var type0" id="S133T0U3484">p_Index</span> = <span class="var type0" id="S133T0U3486">p_Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,655" id="srcline655">655</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,656" id="srcline656">656</a></span><span class="line">                <span class="keyword">case</span> 2 <span class="comment">%Slot B</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,657" id="srcline657">657</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3493">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,658" id="srcline658">658</a></span><span class="line">                        double(<span class="var type0" id="S78T0U3499">pb_SensorTimestamp</span>(<span class="var type0" id="S134T0U3500">pb_Index</span>))/32000,<span class="string">'ADPD173_SlotB'</span>,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,659" id="srcline659">659</a></span><span class="line">                        0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,660" id="srcline660">660</a></span><span class="line">                        0,0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,661" id="srcline661">661</a></span><span class="line">                        15, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,662" id="srcline662">662</a></span><span class="line">                        <span class="var type0" id="S74T0U3513">pb_SlotB_PD1</span>(<span class="var type0" id="S134T0U3514">pb_Index</span>),<span class="var type0" id="S75T0U3516">pb_SlotB_PD2</span>(<span class="var type0" id="S134T0U3517">pb_Index</span>),<span class="var type0" id="S76T0U3519">pb_SlotB_PD3</span>(<span class="var type0" id="S134T0U3520">pb_Index</span>),<span class="var type0" id="S77T0U3522">pb_SlotB_PD4</span>(<span class="var type0" id="S134T0U3523">pb_Index</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,663" id="srcline663">663</a></span><span class="line">                    <span class="var type0" id="S134T0U3526">pb_Index</span> = <span class="var type0" id="S134T0U3528">pb_Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,664" id="srcline664">664</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,665" id="srcline665">665</a></span><span class="line">                <span class="keyword">case</span> 3 <span class="comment">%Accel</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,666" id="srcline666">666</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3535">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,667" id="srcline667">667</a></span><span class="line">                        double(<span class="var type0" id="S98T0U3541">a_SensorTimestamp</span>(<span class="var type0" id="S135T0U3542">a_Index</span>))/32000,<span class="string">'AccelData'</span>,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,668" id="srcline668">668</a></span><span class="line">                        <span class="var type0" id="S93T0U3547">a_AX</span>(<span class="var type0" id="S135T0U3548">a_Index</span>),<span class="var type0" id="S94T0U3550">a_AY</span>(<span class="var type0" id="S135T0U3551">a_Index</span>),<span class="var type0" id="S95T0U3553">a_AZ</span>(<span class="var type0" id="S135T0U3554">a_Index</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,669" id="srcline669">669</a></span><span class="line">                        0,0,0,0,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,670" id="srcline670">670</a></span><span class="line">                        0, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,671" id="srcline671">671</a></span><span class="line">                        0,0,0,0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,672" id="srcline672">672</a></span><span class="line">                    <span class="var type0" id="S135T0U3566">a_Index</span> = <span class="var type0" id="S135T0U3568">a_Index</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,673" id="srcline673">673</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,674" id="srcline674">674</a></span><span class="line">                <span class="keyword">case</span> 4 <span class="comment">%First Refernce HRP meter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,675" id="srcline675">675</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3575">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,676" id="srcline676">676</a></span><span class="line">                        double(<span class="var type0" id="S89T0U3581">r_SensorTimestamp</span>(1,<span class="var type0" id="S136T0U3583">r_Index1</span>))/32000,<span class="var type0" id="S83T0U3586">RefPeripherals</span>{1},<span class="var type0" id="S91T0U3589">r_RefHeartPulseRate</span>(1,<span class="var type0" id="S136T0U3591">r_Index1</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,677" id="srcline677">677</a></span><span class="line">                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,678" id="srcline678">678</a></span><span class="line">                    <span class="var type0" id="S136T0U3606">r_Index1</span> = <span class="var type0" id="S136T0U3608">r_Index1</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,679" id="srcline679">679</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="1,680" id="srcline680">680</a></span><span class="line">                <span class="keyword">case</span> 5 <span class="comment">%Second Reference HPR meter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,681" id="srcline681">681</a></span><span class="line">                    fprintf(<span class="var type0" id="S132T0U3615">fn</span>,<span class="string">'%f,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,682" id="srcline682">682</a></span><span class="line">                        double(<span class="var type0" id="S89T0U3621">r_SensorTimestamp</span>(2,<span class="var type0" id="S140T0U3623">r_Index2</span>))/32000,<span class="var type0" id="S83T0U3626">RefPeripherals</span>{2},<span class="var type0" id="S91T0U3629">r_RefHeartPulseRate</span>(2,<span class="var type0" id="S140T0U3631">r_Index2</span>),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,683" id="srcline683">683</a></span><span class="line">                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);</span></span>
<span class="srcline"><span class="lineno"><a href="1,684" id="srcline684">684</a></span><span class="line">                    <span class="var type0" id="S140T0U3646">r_Index2</span> = <span class="var type0" id="S140T0U3648">r_Index2</span> + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="1,685" id="srcline685">685</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,686" id="srcline686">686</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,687" id="srcline687">687</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,688" id="srcline688">688</a></span><span class="line">        fclose(<span class="var type0" id="S132T0U3653">fn</span>);clear <span class="string">fn</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,689" id="srcline689">689</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,690" id="srcline690">690</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,691" id="srcline691">691</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,692" id="srcline692">692</a></span><span class="line">    fprintf(<span class="string">'-- DONE  --\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,693" id="srcline693">693</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% of if exist input filename</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,694" id="srcline694">694</a></span><span class="line"></pre>
